<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OMEGA CLOUD v32</title>

<style>
:root{
--primary:#00ff41;
--dim:#004400;
--blue:#00ccff;
--pink:#ff69b4;
--red:#ff3333;
--gold:#ffcc00;
}

body{
margin:0;
background:#000;
font-family:'Courier New',monospace;
color:var(--primary);
}

#login-page{
position:fixed;
inset:0;
display:flex;
justify-content:center;
align-items:center;
}

.login-card{
width:90%;
max-width:380px;
padding:30px;
border:1px solid var(--primary);
background:#000;
box-shadow:0 0 25px var(--primary);
text-align:center;
}

.hacker-input{
width:100%;
background:transparent;
border:1px solid var(--dim);
padding:10px;
color:var(--primary);
margin-bottom:10px;
text-align:center;
}

.btn-hack{
width:100%;
background:var(--primary);
color:#000;
border:none;
padding:10px;
font-weight:bold;
cursor:pointer;
}

#main-app{
display:none;
padding:15px;
}

.header{
display:flex;
justify-content:space-between;
border-bottom:1px solid var(--dim);
padding-bottom:10px;
margin-bottom:15px;
}

.node-card{
border:1px solid var(--dim);
padding:15px;
margin-bottom:15px;
}

.amount{
font-size:2rem;
margin:10px 0;
cursor:pointer;
}

audio{
width:100%;
margin-top:8px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login-page">
<div class="login-card">
<h2>OMEGA_v32</h2>

<input type="text" id="user" class="hacker-input" placeholder="USUARIO">
<input type="password" id="pass" class="hacker-input" placeholder="CONTRASEÑA">

<button id="btn-main" class="btn-hack" onclick="iniciarEscaneo()">ACCEDER</button>

<div style="margin-top:15px;font-size:0.7rem;">
<span onclick="toggleReg()" id="reg-text" style="color:var(--blue);cursor:pointer;">[REGISTRAR]</span>
</div>
</div>
</div>

<!-- APP -->
<div id="main-app">

<div class="header">
<span id="display-user"></span>
<span id="sync-status">● CORE_CONNECTED</span>
<button onclick="location.reload()" style="background:red;color:white;border:none;padding:5px;">SALIR</button>
</div>

<!-- MÚSICA -->
<div style="background:#0a0a0a;border:1px solid var(--primary);padding:10px;margin-bottom:15px;">
<select id="track-list" onchange="changeTrack()" style="width:100%;background:#000;color:var(--primary);border:1px solid var(--dim);">
<option value="">-- MÚSICA --</option>
<option value="antestehubieraconocido.mp3">Si Antes Te Hubiera Conocido</option>
<option value="papasito.mp3">Papasito</option>
<option value="unanochemedellin.mp3">Una Noche en Medellín</option>
<option value="titimepregunto.mp3">Tití Me Preguntó</option>
</select>
<audio controls id="main-audio"></audio>
</div>

<div id="panel-controls"></div>

<div class="node-card">
<small>[ HISTORIAL ]</small>
<div id="panel-logs"></div>
</div>

</div>

<script>
const BIN_ID='698bb9a743b1c97be975254f';
const MASTER_KEY='$2a$10$spjxIrYFxGQiKIYND0MrkOg3V6pY4nV.R/US9pa3CWpGr3Se2vutm';
const MASTER_EDIT="2026";

let db={auth:{},data:{}};
let currentUser="";
let regMode=false;

/* ================= SYNC ================= */
async function sync(push=false){
try{
if(push){
await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`,{
method:'PUT',
headers:{'Content-Type':'application/json','X-Master-Key':MASTER_KEY},
body:JSON.stringify(db)
});
}else{
const res=await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`,{
headers:{'X-Master-Key':MASTER_KEY,'X-Bin-Meta':'false'}
});
db=await res.json();
}
}catch(e){console.log("SYNC ERROR");}
}

/* ================= LOGIN ================= */
async function iniciarEscaneo(){
await sync();

const u=document.getElementById("user").value.toLowerCase().trim();
const p=document.getElementById("pass").value.trim();

if(!u||!p) return alert("Campos vacíos");

if(regMode){
if(db.auth[u]) return alert("Usuario ya existe");
db.auth[u]={user:u,pass:p,active:true,last:Date.now()};
await sync(true);
alert("Registrado");
location.reload();
return;
}

if(db.auth[u] && db.auth[u].pass===p){
currentUser=u;
db.auth[u].last=Date.now();
await sync(true);

document.getElementById("login-page").style.display="none";
document.getElementById("main-app").style.display="block";
document.getElementById("display-user").innerText="OP: "+u.toUpperCase();

renderUI();
}else{
alert("Credenciales incorrectas");
}
}

function toggleReg(){
regMode=!regMode;
document.getElementById("btn-main").innerText=regMode?"REGISTRAR":"ACCEDER";
document.getElementById("reg-text").innerText=regMode?"[VOLVER]":"[REGISTRAR]";
}

/* ================= MOVIMIENTOS ================= */
async function mov(id,tipo){
await sync();

let c=document.getElementById(`c-${id}`).value.trim();
let m=parseFloat(document.getElementById(`m-${id}`).value);

if(!c||isNaN(m)||m<=0) return;

if(!db.data[id]) db.data[id]={saldo:0,logs:[]};

db.data[id].saldo+=(tipo==='IN'?m:-m);

db.data[id].logs.push({
t:Date.now(),
desc:c,
val:m,
type:tipo,
op:currentUser,
node:id
});

await sync(true);
renderUI();
}

/* ================= RENDER ================= */
function renderUI(){
const container=document.getElementById("panel-controls");
container.innerHTML="";

if(currentUser==="vicrocrook"){
renderCard("vicro_airtm","VICRO_AIRTM","var(--blue)");
renderCard("vicro_cap","RESERVA_CAPITAL","var(--primary)");
renderLogs(["vicro_airtm","vicro_cap"]);
}else if(currentUser==="kassy10"){
renderCard("kassy_caja","CAJA_KASSY","var(--pink)");
renderLogs(["kassy_caja"]);
}else{
let node=currentUser+"_caja";
renderCard(node,"CAJA_"+currentUser.toUpperCase(),"var(--pink)");
renderLogs([node]);
}
}

function renderCard(id,title,color){
if(!db.data[id]) db.data[id]={saldo:0,logs:[]};

const container=document.getElementById("panel-controls");

container.innerHTML+=`
<div class="node-card">
<small style="color:${color}">[ ${title} ]</small>
<div class="amount" onclick="ajustar('${id}')">$${db.data[id].saldo.toLocaleString()}</div>
<input id="c-${id}" class="hacker-input" placeholder="CONCEPTO">
<input id="m-${id}" type="number" class="hacker-input" placeholder="MONTO">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:5px;">
<button class="btn-hack" onclick="mov('${id}','IN')">DEP</button>
<button class="btn-hack" style="background:red;color:white;" onclick="mov('${id}','OUT')">GAS</button>
</div>
</div>`;
}

function renderLogs(nodes){
const logBox=document.getElementById("panel-logs");
logBox.innerHTML="";

let all=[];
nodes.forEach(n=>{if(db.data[n]) all=all.concat(db.data[n].logs)});

all.sort((a,b)=>b.t-a.t).slice(0,20).forEach(l=>{
logBox.innerHTML+=`
<div style="display:flex;justify-content:space-between;border-bottom:1px solid #222;padding:5px 0;font-size:0.7rem;">
<span>${l.desc}<br><small>${l.op}</small></span>
<span style="color:${l.type==='IN'?'#0f4':'#f44'}">
${l.type==='IN'?'+':'-'}$${l.val.toLocaleString()}
<button onclick="eliminarMovimiento('${l.node}',${l.t})" style="background:red;color:white;border:none;font-size:0.6rem;">X</button>
</span>
</div>`;
});
}

/* ================= AJUSTAR ================= */
async function ajustar(id){
if(prompt("MASTER KEY:")!==MASTER_EDIT) return;
let v=prompt("Nuevo saldo:");
if(!v) return;
db.data[id].saldo=parseFloat(v);
await sync(true);
renderUI();
}

/* ================= ELIMINAR ================= */
async function eliminarMovimiento(node,timestamp){
if(prompt("MASTER KEY:")!==MASTER_EDIT) return;

const index=db.data[node].logs.findIndex(l=>l.t===timestamp);
if(index===-1) return;

const mov=db.data[node].logs[index];
db.data[node].saldo-=(mov.type==='IN'?mov.val:-mov.val);
db.data[node].logs.splice(index,1);

await sync(true);
renderUI();
}

/* ================= MUSICA ================= */
function changeTrack(){
let audio=document.getElementById("main-audio");
audio.src=document.getElementById("track-list").value;
if(audio.src) audio.play();
}

/* ================= AUTO SYNC ================= */
setInterval(async()=>{
if(currentUser){
await sync();
renderUI();
}
},5000);
</script>

</body>
</html>

