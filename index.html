<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>OMEGA CLOUD FIXED</title>

<style>
:root{
--primary:#00ff41;
--dim:#004400;
--blue:#00ccff;
--pink:#ff69b4;
--red:#ff3333;
--gold:#ffcc00;
--vh:1vh;
}

body{
margin:0;
background:#000;
font-family:'Courier New',monospace;
color:var(--primary);
overflow:auto;
}

body.vicro-theme{--primary:#00ff41;--dim:#004400;}
body.kassy-theme{--primary:var(--pink);--dim:#440022;}

#login-page{
position:fixed;
inset:0;
display:flex;
justify-content:center;
align-items:center;
background:#000;
}

.login-card{
width:90%;
max-width:380px;
padding:25px;
border:1px solid var(--primary);
box-shadow:0 0 25px var(--primary);
text-align:center;
border-radius:12px;
}

.hacker-input{
width:100%;
background:transparent;
border:1px solid var(--dim);
padding:14px;
color:var(--primary);
margin-bottom:10px;
border-radius:8px;
text-align:center;
}

.btn-hack{
width:100%;
background:var(--primary);
color:#000;
border:none;
padding:14px;
font-weight:bold;
border-radius:8px;
cursor:pointer;
}

#main-app{
display:none;
min-height:calc(var(--vh)*100);
padding:12px;
padding-bottom:140px;
overflow-y:auto;
}

.header{
display:flex;
justify-content:space-between;
border-bottom:1px solid var(--dim);
padding-bottom:10px;
margin-bottom:12px;
}

.node-card{
border:1px solid var(--dim);
padding:15px;
margin-bottom:12px;
border-radius:12px;
}

.amount{
font-size:2rem;
margin:10px 0;
font-weight:bold;
cursor:pointer;
}

.tabs{
display:flex;
gap:8px;
margin-bottom:10px;
}

.tab-btn{
flex:1;
padding:12px;
background:#000;
border:1px solid var(--dim);
color:var(--primary);
border-radius:10px;
cursor:pointer;
font-weight:bold;
}

.tab-btn.active{
border-color:var(--gold);
box-shadow:0 0 10px var(--gold);
}

.log-row{
display:flex;
justify-content:space-between;
border-bottom:1px solid #222;
padding:6px 0;
font-size:0.8rem;
}

.btn-del{
background:var(--red);
color:#fff;
border:none;
padding:3px 8px;
font-size:0.65rem;
border-radius:6px;
cursor:pointer;
}
</style>
</head>

<body class="vicro-theme">

<div id="login-page">
<div class="login-card">
<h2>OMEGA LOGIN</h2>

<input type="text" id="user" class="hacker-input" placeholder="USUARIO">
<input type="password" id="pass" class="hacker-input" placeholder="CONTRASEÑA">

<button class="btn-hack" onclick="iniciarEscaneo()">ACCEDER</button>

<div style="margin-top:12px;font-size:0.7rem;">
<span onclick="toggleReg()" id="reg-text" style="color:var(--blue);cursor:pointer;">[REGISTRAR]</span> |
<span onclick="cambiarPassLogin()" style="color:var(--pink);cursor:pointer;">[CAMBIAR PASS]</span>
</div>
</div>
</div>

<div id="main-app">
<div class="header">
<span id="display-user"></span>
<span id="sync-status">● ONLINE</span>
<button onclick="location.reload()" style="background:var(--red);color:white;border:none;padding:6px;border-radius:8px;">SALIR</button>
</div>

<div id="panel-controls"></div>

<div class="node-card">
<small>[ HISTORIAL ]</small>
<div id="panel-logs"></div>
</div>
</div>

<script>
const BIN_ID='698bb9a743b1c97be975254f';
const MASTER_KEY='$2a$10$spjxIrYFxGQiKIYND0MrkOg3V6pY4nV.R/US9pa3CWpGr3Se2vutm';
const MASTER_EDIT="2026";

let db={auth:{},data:{}};
let currentUser="";
let regMode=false;
let vicroTab="vicro_airtm";

/* FIX vh móvil */
function setVH(){
const vh=window.innerHeight*0.01;
document.documentElement.style.setProperty('--vh',`${vh}px`);
}
setVH();
window.addEventListener('resize',setVH);

/* Evitar cierre teclado */
document.addEventListener('focusin',e=>{
if(e.target.tagName==="INPUT"){
setTimeout(()=>{e.target.scrollIntoView({block:'center'});},200);
}
});

/* SYNC */
async function sync(push=false){
if(push){
await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`,{
method:'PUT',
headers:{'Content-Type':'application/json','X-Master-Key':MASTER_KEY},
body:JSON.stringify(db)
});
}else{
const res=await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`,{
headers:{'X-Master-Key':MASTER_KEY,'X-Bin-Meta':'false'}
});
const d=await res.json();
if(d&&d.auth)db=d;
}
}

/* LOGIN */
async function iniciarEscaneo(){
await sync();
const u=user.value.toLowerCase().trim();
const p=pass.value.trim();
if(!u||!p)return alert("Campos vacíos");

if(regMode){
if(db.auth[u])return alert("Existe");
db.auth[u]={user:u,pass:p,active:true,access:(u==="kassy10"?"kassy":"vicro")};
await sync(true);
alert("Registrado");
location.reload();
return;
}

if(db.auth[u]&&db.auth[u].pass===p){
currentUser=u;
document.body.className=(u==="kassy10")?"kassy-theme":"vicro-theme";
login-page.style.display="none";
main-app.style.display="block";
display-user.innerText="OP: "+u.toUpperCase();
renderUI();
}else alert("Error");
}

function toggleReg(){
regMode=!regMode;
btn-main.innerText=regMode?"REGISTRAR":"ACCEDER";
reg-text.innerText=regMode?"[VOLVER]":"[REGISTRAR]";
}

async function cambiarPassLogin(){
await sync();
let u=prompt("Usuario:");
if(!db.auth[u])return alert("No existe");
if(prompt("Pass actual:")!==db.auth[u].pass)return alert("Incorrecta");
let n=prompt("Nueva:");
db.auth[u].pass=n;
await sync(true);
alert("Actualizada");
}

/* PERMISOS */
function canEditNode(node){
if(currentUser==="vicrocrook")return true;
if(node===currentUser+"_caja")return true;
if(currentUser==="kassy10"&&node==="kassy_caja")return true;
return false;
}

/* MOV */
async function mov(id,tipo){
let c=document.getElementById(`c-${id}`).value.trim();
let m=parseFloat(document.getElementById(`m-${id}`).value);
if(!c||isNaN(m)||m<=0)return;
await sync();
if(!db.data[id])db.data[id]={saldo:0,logs:[]};
db.data[id].saldo+=(tipo==="IN"?m:-m);
db.data[id].logs.push({t:Date.now(),desc:c,val:m,type:tipo,node:id});
await sync(true);
renderUI();
}

async function eliminarMovimiento(node,timestamp){
if(!canEditNode(node))return alert("Denegado");
if(currentUser==="vicrocrook"){
if(prompt("MASTER KEY:")!==MASTER_EDIT)return;
}
await sync();
let idx=db.data[node].logs.findIndex(x=>x.t===timestamp);
if(idx<0)return;
let mov=db.data[node].logs[idx];
db.data[node].saldo-=(mov.type==="IN"?mov.val:-mov.val);
db.data[node].logs.splice(idx,1);
await sync(true);
renderUI();
}

/* UI */
function renderUI(){
const container=document.getElementById("panel-controls");
container.innerHTML="";
let access=db.auth[currentUser].access;

if(access==="vicro"){
container.innerHTML=`
<div class="tabs">
<button class="tab-btn ${vicroTab==='vicro_airtm'?'active':''}" onclick="vicroTab='vicro_airtm';renderUI()">AIRTM</button>
<button class="tab-btn ${vicroTab==='vicro_cap'?'active':''}" onclick="vicroTab='vicro_cap';renderUI()">CAP</button>
</div>
`;
renderCard(vicroTab);
renderLogs([vicroTab]);
}else{
let node=(currentUser==="kassy10")?"kassy_caja":currentUser+"_caja";
renderCard(node);
renderLogs([node]);
}
}

function renderCard(id){
if(!db.data[id])db.data[id]={saldo:0,logs:[]};
panel-controls.innerHTML+=`
<div class="node-card">
<div class="amount">$${db.data[id].saldo.toLocaleString()}</div>
<input id="c-${id}" class="hacker-input" placeholder="Concepto">
<input id="m-${id}" type="number" class="hacker-input" placeholder="Monto">
<div style="display:grid;grid-template-columns:1fr 1fr;gap:6px;">
<button class="btn-hack" onclick="mov('${id}','IN')">DEP</button>
<button class="btn-hack" style="background:var(--red);color:#fff;" onclick="mov('${id}','OUT')">GAS</button>
</div>
</div>
`;
}

function renderLogs(nodes){
panel-logs.innerHTML="";
let all=[];
nodes.forEach(n=>{if(db.data[n])all=all.concat(db.data[n].logs);});
all.sort((a,b)=>b.t-a.t).forEach(l=>{
panel-logs.innerHTML+=`
<div class="log-row">
<span>${l.desc}</span>
<span style="color:${l.type==='IN'?'#0f4':'#f44'}">
${l.type==='IN'?'+':'-'}$${l.val}
<button class="btn-del" onclick="eliminarMovimiento('${l.node}',${l.t})">X</button>
</span>
</div>`;
});
}

/* SYNC inteligente */
setInterval(async()=>{
if(!currentUser)return;
const active=document.activeElement;
if(active&&(active.tagName==="INPUT"||active.tagName==="TEXTAREA"))return;
await sync();
renderUI();
},5000);
</script>

</body>
</html>

