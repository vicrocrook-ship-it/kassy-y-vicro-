<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VICRO SYSTEM | v36.5 PLATINUM</title>
    <style>
        :root {
            --primary: #00ff41; --bg: #000; --card: rgba(10, 10, 10, 0.9);
            --red: #ff3333; --blue: #00ccff; --pink: #ff69b4; --gold: #ffcc00;
        }
        body.vicro-theme { --primary: #00ff41; --dim: #004400; }
        body.kassy-theme { --primary: var(--pink); --dim: #440022; }
        body.cap-active { --primary: var(--gold); --dim: #443300; }

        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; font-family: 'Courier New', monospace; overflow: hidden; color: var(--primary); transition: 0.5s; }
        #canvas-bg { position: fixed; inset: 0; z-index: -2; }

        /* CORAZÓN KASSY - CAPA CORREGIDA */
        #kassy-heart {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: -1; text-align: center; pointer-events: none; width: 100%;
        }
        .heart {
            font-size: 18rem; color: var(--pink); opacity: 0.2;
            animation: beat 1.5s infinite; text-shadow: 0 0 50px var(--pink);
        }
        .heart-text {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 2rem; color: var(--pink); font-weight: bold; text-shadow: 0 0 10px #000;
            letter-spacing: 5px;
        }
        @keyframes beat {
            0%, 100% { transform: scale(1); opacity: 0.15; }
            50% { transform: scale(1.2); opacity: 0.35; }
        }

        /* Login */
        #login-page { position: fixed; inset: 0; z-index: 2000; background: #000; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .vicro-brand { font-size: 3.2rem; font-weight: bold; text-shadow: 0 0 25px var(--primary); letter-spacing: 8px; margin-bottom: 30px; text-align: center; }
        .login-card { text-align: center; width: 90%; max-width: 380px; border: 2px solid var(--primary); padding: 40px 30px; background: rgba(0,0,0,0.95); box-shadow: 0 0 60px var(--dim); border-radius: 15px; }
        .hacker-input { width: 100%; background: transparent; border: 1px solid var(--dim); padding: 14px; color: var(--primary); outline: none; margin-bottom: 15px; text-align: center; box-sizing: border-box; font-weight: bold; }
        .btn-hack { width: 100%; background: var(--primary); color: #000; border: none; padding: 15px; font-weight: bold; cursor: pointer; text-transform: uppercase; }

        /* UI */
        #main-app { display: none; height: 100vh; flex-direction: column; padding: 10px; box-sizing: border-box; position: relative; z-index: 10; }
        .header { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid var(--dim); font-size: 0.75rem; background: rgba(0,0,0,0.5); }
        .tab-container { display: none; gap: 10px; margin: 10px 0; }
        .tab-btn { flex: 1; padding: 12px; background: #111; border: 1px solid var(--dim); color: var(--primary); cursor: pointer; font-weight: bold; }
        .tab-btn.active { background: var(--primary); color: #000; }
        .node-card { background: var(--card); border: 1px solid var(--dim); padding: 20px; border-radius: 4px; border-left: 5px solid var(--primary); margin-bottom: 15px; backdrop-filter: blur(2px); }
        .amount { font-size: 3rem; font-weight: bold; margin: 10px 0; text-align: center; cursor: pointer; }
        .log-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; padding: 8px 0; font-size: 0.75rem; }
        #player-vicro { background: rgba(10,10,10,0.8); border: 1px solid var(--primary); padding: 10px; border-radius: 8px; margin-bottom: 10px;}
        audio { width: 100%; height: 35px; filter: invert(1); margin-top: 8px; }
    </style>
</head>
<body>
    <canvas id="canvas-bg"></canvas>

    <div id="kassy-heart">
        <div class="heart">❤</div>
        <div class="heart-text">TE AMO</div>
    </div>

    <div id="login-page">
        <div class="vicro-brand">VICRO SYSTEM</div>
        <div class="login-card">
            <input type="text" id="user" class="hacker-input" placeholder="OPERADOR">
            <input type="password" id="pass" class="hacker-input" placeholder="CONTRASEÑA">
            <button class="btn-hack" onclick="validarEntrada()">CONECTAR NÚCLEO</button>
            <div style="margin-top:25px; font-size: 0.7rem;">
                <span onclick="configAcceso()" style="color:var(--gold); cursor:pointer;">[SISTEMA DE AJUSTES]</span>
            </div>
        </div>
    </div>

    <div id="main-app">
        <div class="header">
            <span id="display-user"></span>
            <span id="sync-status" style="color: var(--gold)">● LIVE_SYNC</span>
            <button onclick="location.reload()" style="background:var(--red); color:white; border:none; padding:4px 12px; cursor:pointer; font-weight:bold;">CERRAR</button>
        </div>
        <div id="vicro-tabs" class="tab-container">
            <button class="tab-btn active" id="btn-airtm" onclick="switchTab('airtm')">AIRTM</button>
            <button class="tab-btn" id="btn-cap" onclick="switchTab('cap')">CAPITAL</button>
        </div>
        <div id="player-vicro">
            <select id="track-list" onchange="changeTrack()" style="width:100%; background:#000; color:var(--primary); border:1px solid var(--dim); padding: 8px;">
                <option value="">-- MÚSICA (8 PISTAS) --</option>
                <option value="antestehubieraconocido.mp3">Si Antes Te Hubiera Conocido</option>
                <option value="papasito.mp3">Papasito</option>
                <option value="unanochemedellin.mp3">Una Noche en Medellín</option>
                <option value="titimepregunto.mp3">Tití Me Preguntó</option>
                <option value="xclana.mp3">X Clana</option>
                <option value="vamospapr.mp3">Vamos pa PR</option>
                <option value="debitirarmasfotos.mp3">Debí Tirar Más Fotos</option>
                <option value="vitamina.mp3">Vitamina</option>
            </select>
            <audio controls id="main-audio"></audio>
        </div>
        <div style="display: grid; grid-template-columns: 1fr; gap: 15px; overflow-y: auto;">
            <div id="panel-controls"></div>
            <div class="node-card">
                <small id="log-title">[ HISTORIAL ]</small>
                <div id="panel-logs" style="margin-top:10px;"></div>
            </div>
        </div>
    </div>

    <script>
        const BIN_ID = '698bb9a743b1c97be975254f';
        const MASTER_KEY = '$2a$10$spjxIrYFxGQiKIYND0MrkOg3V6pY4nV.R/US9pa3CWpGr3Se2vutm';
        
        let db = { 
            auth: {
                "vicrocrook": { user: "vicrocrook", pass: "soyelmaster", active: true, access: "vicro" },
                "kassy10": { user: "kassy10", pass: "ojitosbonitos", active: true, access: "kassy" }
            }, 
            data: { "vicro_airtm": { saldo: 0, logs: [] }, "vicro_cap": { saldo: 0, logs: [] }, "kassy_caja": { saldo: 0, logs: [] } },
            lastUpdate: 0 
        };

        let currentUser = ""; let currentTab = "airtm"; let localTimestamp = 0; let syncLock = false;

        async function sync(push = false) {
            if(syncLock && !push) return;
            const headers = { 'X-Master-Key': MASTER_KEY, 'Content-Type': 'application/json', 'X-Bin-Meta': 'false' };
            try {
                if (push) {
                    syncLock = true;
                    db.lastUpdate = Date.now();
                    localTimestamp = db.lastUpdate;
                    await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, { method: 'PUT', headers, body: JSON.stringify(db) });
                    setTimeout(() => { syncLock = false; }, 2000);
                } else {
                    const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { headers });
                    const d = await res.json();
                    if (d.lastUpdate > localTimestamp) {
                        db = d;
                        localTimestamp = d.lastUpdate;
                        if (currentUser) renderUI();
                    }
                }
            } catch (e) { syncLock = false; }
        }

        setInterval(() => { if (currentUser && !syncLock) sync(); }, 2500);

        async function validarEntrada() {
            const u = document.getElementById('user').value.toLowerCase();
            const p = document.getElementById('pass').value;
            await sync(); 
            if (db.auth[u] && db.auth[u].pass === p) {
                currentUser = u;
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('main-app').style.display = 'flex';
                
                if (u === 'kassy10') {
                    document.body.className = 'kassy-theme';
                    document.getElementById('kassy-heart').style.display = 'block';
                } else {
                    document.body.className = 'vicro-theme';
                    document.getElementById('kassy-heart').style.display = 'none';
                }

                document.getElementById('display-user').innerText = "OP: " + u.toUpperCase();
                if (db.auth[u].access === 'vicro') document.getElementById('vicro-tabs').style.display = 'flex';
                renderUI();
            } else { alert("ACCESO DENEGADO"); }
        }

        async function configAcceso() {
            await sync();
            if (prompt("ADMIN KEY:") !== "2026") return;
            let u = prompt("OPERADOR:").toLowerCase();
            if (!db.auth[u]) return alert("NO EXISTE");
            let op = prompt("1. Nueva Pass | 2. ELIMINAR | 3. ACTIVAR");
            if (op === "1") { 
                db.auth[u].pass = prompt("NUEVA CLAVE:"); 
                await sync(true); 
                alert("CLAVE GUARDADA.");
            }
            else if (op === "2") { delete db.auth[u]; await sync(true); }
            else if (op === "3") { if(!db.auth[u]) db.auth[u]={user:u}; db.auth[u].active = true; db.auth[u].access="vicro"; await sync(true); }
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-' + tab).classList.add('active');
            if (tab === 'cap') document.body.classList.add('cap-active'); else document.body.classList.remove('cap-active');
            renderUI();
        }

        function renderUI() {
            const container = document.getElementById('panel-controls');
            container.innerHTML = "";
            const isVicro = db.auth[currentUser].access === 'vicro';
            const node = isVicro ? (currentTab === 'airtm' ? "vicro_airtm" : "vicro_cap") : "kassy_caja";
            const color = (node === 'vicro_airtm') ? 'var(--blue)' : (node === 'vicro_cap' ? 'var(--gold)' : 'var(--pink)');
            container.innerHTML = `<div class="node-card" style="border-left-color:${color}"><small style="color:${color}">[ ${node.toUpperCase()} ]</small><div class="amount" onclick="ajustar('${node}')">$${db.data[node].saldo.toLocaleString()}</div><input type="text" id="c-box" class="hacker-input" placeholder="CONCEPTO"><input type="number" id="m-box" class="hacker-input" placeholder="MONTO $"><div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;"><button class="btn-hack" style="background:${color}" onclick="mov('${node}','IN')">DEPÓSITO</button><button class="btn-hack" style="background:var(--red); color:white" onclick="mov('${node}','OUT')">GASTO</button></div></div>`;
            renderLogs(node);
        }

        async function mov(id, tipo) {
            const c = document.getElementById('c-box').value, m = parseFloat(document.getElementById('m-box').value);
            if (!c || isNaN(m)) return;
            await sync();
            db.data[id].saldo += (tipo === 'IN' ? m : -m);
            db.data[id].logs.push({ id: Date.now(), desc: c.toUpperCase(), val: m, type: tipo, op: currentUser });
            renderUI();
            await sync(true);
        }

        function renderLogs(id) {
            const logBox = document.getElementById('panel-logs'); logBox.innerHTML = "";
            document.getElementById('log-title').innerText = `[ HISTORIAL_${id.toUpperCase()} ]`;
            if (db.data[id] && db.data[id].logs) {
                [...db.data[id].logs].reverse().slice(0, 15).forEach(l => {
                    logBox.innerHTML += `<div class="log-item"><span>${l.desc}<br><small>POR: ${l.op}</small></span><span><b style="color:${l.type==='IN'?'#0f4':'#f44'}">${l.type==='IN'?'+':'-'}$${l.val.toLocaleString()}</b><span style="color:red; cursor:pointer; margin-left:10px; font-weight:bold;" onclick="borrarLinea('${id}', ${l.id})">X</span></span></div>`;
                });
            }
        }

        async function borrarLinea(nodeId, logId) {
            if (prompt("KEY MAESTRA:") === "2026") {
                await sync();
                const item = db.data[nodeId].logs.find(l => l.id === logId);
                if (item) {
                    db.data[nodeId].saldo += (item.type === 'OUT' ? item.val : -item.val);
                    db.data[nodeId].logs = db.data[nodeId].logs.filter(l => l.id !== logId);
                    renderUI(); await sync(true);
                }
            }
        }

        async function ajustar(id) { if (prompt("KEY MAESTRA:") === "2026") { let v = prompt("SALDO:"); if (v) { db.data[id].saldo = parseFloat(v); await sync(true); renderUI(); } } }
        function changeTrack() { const a = document.getElementById('main-audio'); a.src = document.getElementById('track-list').value; if (a.src) a.play(); }

        const canvas = document.getElementById('canvas-bg'), ctx = canvas.getContext('2d');
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = resize; resize();
        function anim() {
            ctx.fillStyle = "rgba(0,0,0,0.2)"; ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--primary');
            for(let i=0; i<15; i++) { ctx.fillRect(Math.random()*canvas.width, Math.random()*canvas.height, 2, 2); }
            requestAnimationFrame(anim);
        }
        anim();
    </script>
</body>
</html>
