<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VICRO SYSTEM | v38.3 ULTIMATE</title>
    <style>
        :root {
            --primary: #00ff41; --bg: #000; --card: rgba(10, 10, 10, 0.8);
            --red: #ff3333; --blue: #00ccff; --pink: #ff69b4; --gold: #ffcc00;
        }
        body.vicro-theme { --primary: #00ff41; --dim: #004400; }
        body.kassy-theme { --primary: var(--pink); --dim: #440022; }

        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; font-family: 'Courier New', monospace; overflow: hidden; color: var(--primary); }
        #canvas-bg { position: fixed; inset: 0; z-index: -2; }

        /* AVISO DE SINCRONIZACIÓN FORZADA */
        #sync-overlay {
            display: none; position: fixed; inset: 0; background: #000;
            z-index: 9999; flex-direction: column; justify-content: center; align-items: center;
            color: var(--primary); border: 2px solid var(--primary);
        }

        #login-page { position: fixed; inset: 0; z-index: 2000; background: #000; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .vicro-brand { font-size: 3rem; font-weight: bold; text-shadow: 0 0 20px var(--primary); letter-spacing: 5px; margin-bottom: 30px; text-align: center; }
        .login-card { text-align: center; width: 85%; max-width: 380px; border: 1px solid var(--primary); padding: 30px; background: rgba(0,0,0,0.9); border-radius: 15px; }
        .hacker-input { width: 100%; background: transparent; border: 1px solid var(--primary); padding: 15px; color: var(--primary); outline: none; margin-bottom: 15px; text-align: center; box-sizing: border-box; }
        .btn-hack { width: 100%; background: var(--primary); color: #000; border: none; padding: 15px; font-weight: bold; cursor: pointer; }

        #main-app { display: none; height: 100vh; flex-direction: column; padding: 10px; box-sizing: border-box; }
        .header { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid var(--primary); font-size: 0.7rem; }
        .node-card { background: var(--card); border: 1px solid var(--primary); padding: 20px; border-radius: 10px; margin-top: 15px; backdrop-filter: blur(10px); }
        .amount { font-size: 3rem; font-weight: bold; margin: 10px 0; text-align: center; }
        audio { width: 100%; height: 30px; filter: invert(1); margin-top: 10px; }
    </style>
</head>
<body>
    <canvas id="canvas-bg"></canvas>

    <div id="sync-overlay">
        <h2 id="sync-msg">ACTUALIZANDO NUBE...</h2>
    </div>

    <div id="login-page">
        <div class="vicro-brand">VICRO SYSTEM</div>
        <div class="login-card">
            <input type="text" id="user" class="hacker-input" placeholder="USUARIO">
            <input type="password" id="pass" class="hacker-input" placeholder="CONTRASEÑA">
            <button class="btn-hack" onclick="validarEntrada()">CONECTAR</button>
            <div onclick="configAcceso()" style="margin-top:20px; font-size: 0.6rem; color:var(--gold); cursor:pointer;">[ AJUSTES CRÍTICOS ]</div>
        </div>
    </div>

    <div id="main-app">
        <div class="header">
            <span id="display-user"></span>
            <span id="sync-status">● EN LÍNEA</span>
            <button onclick="location.reload()" style="background:var(--red); color:white; border:none; padding:2px 8px;">LOGOUT</button>
        </div>
        <div id="panel-controls"></div>
        <div class="node-card"><small>[ HISTORIAL ]</small><div id="panel-logs" style="max-height: 150px; overflow-y: auto; font-size: 0.7rem;"></div></div>
    </div>

    <script>
        const BIN_ID = '698bb9a743b1c97be975254f';
        const MASTER_KEY = '$2a$10$spjxIrYFxGQiKIYND0MrkOg3V6pY4nV.R/US9pa3CWpGr3Se2vutm';
        
        let db = { 
            auth: {
                "vicrocrook": { user: "vicrocrook", pass: "soyelmaster", active: true, access: "vicro" },
                "kassy10": { user: "kassy10", pass: "ojitosbonitos", active: true, access: "kassy" }
            }, 
            data: { "vicro_airtm": { saldo: 0, logs: [] }, "vicro_cap": { saldo: 0, logs: [] }, "kassy_caja": { saldo: 0, logs: [] } },
            lastUpdate: 0 
        };

        let currentUser = ""; let localTimestamp = 0; let syncLock = false;

        async function sync(push = false) {
            if(syncLock && !push) return;
            const headers = { 'X-Master-Key': MASTER_KEY, 'Content-Type': 'application/json', 'X-Bin-Meta': 'false' };
            // El ?v=${Date.now()} obliga al navegador a saltarse la caché
            const url = `https://api.jsonbin.io/v3/b/${BIN_ID}${push ? '' : '/latest?v=' + Date.now()}`;

            try {
                if (push) {
                    syncLock = true;
                    db.lastUpdate = Date.now();
                    const res = await fetch(url, { method: 'PUT', headers, body: JSON.stringify(db) });
                    if(res.ok) {
                        document.getElementById('sync-overlay').style.display = 'flex';
                        document.getElementById('sync-msg').innerText = "CAMBIO EXITOSO - REINICIANDO";
                        setTimeout(() => { location.reload(); }, 1500);
                    }
                } else {
                    const res = await fetch(url, { headers });
                    const d = await res.json();
                    if (d.lastUpdate > localTimestamp) {
                        db = d; localTimestamp = d.lastUpdate;
                        if (currentUser) renderUI();
                    }
                }
            } catch (e) { syncLock = false; }
        }

        setInterval(() => { if (currentUser && !syncLock) sync(); }, 3000);

        async function validarEntrada() {
            const u = document.getElementById('user').value.toLowerCase().trim();
            const p = document.getElementById('pass').value.trim();
            document.getElementById('sync-status').innerText = "CONECTANDO...";
            await sync(); 
            if (db.auth[u] && db.auth[u].pass === p) {
                currentUser = u;
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('main-app').style.display = 'flex';
                document.body.className = (u === 'kassy10') ? 'kassy-theme' : 'vicro-theme';
                document.getElementById('display-user').innerText = u.toUpperCase();
                renderUI();
            } else { alert("Error: Datos incorrectos."); }
        }

        async function configAcceso() {
            await sync();
            if (prompt("KEY:") !== "2026") return;
            let u = prompt("USER (kassy10 o vicrocrook):").toLowerCase().trim();
            let newP = prompt("NUEVA CONTRASEÑA:").trim();
            if(u && newP && db.auth[u]) {
                db.auth[u].pass = newP;
                await sync(true); 
            }
        }

        function renderUI() {
            const container = document.getElementById('panel-controls'); container.innerHTML = "";
            const node = (currentUser === 'kassy10') ? "kassy_caja" : "vicro_airtm";
            const color = (currentUser === 'kassy10') ? 'var(--pink)' : 'var(--blue)';
            container.innerHTML = `<div class="node-card" style="border-top: 4px solid ${color}"><small>${node.toUpperCase()}</small><div class="amount">$${db.data[node].saldo.toLocaleString()}</div><input type="text" id="c-box" class="hacker-input" placeholder="Concepto"><input type="number" id="m-box" class="hacker-input" placeholder="Monto $"><button class="btn-hack" style="background:${color}" onclick="mov('${node}','IN')">REGISTRAR</button></div>`;
            renderLogs(node);
        }

        async function mov(id, tipo) {
            const c = document.getElementById('c-box').value, m = parseFloat(document.getElementById('m-box').value);
            if (!c || isNaN(m)) return;
            await sync();
            db.data[id].saldo += m;
            db.data[id].logs.push({ id: Date.now(), desc: c.toUpperCase(), val: m, op: currentUser });
            renderUI(); await sync(true);
        }

        function renderLogs(id) {
            const logBox = document.getElementById('panel-logs'); logBox.innerHTML = "";
            if (db.data[id] && db.data[id].logs) {
                [...db.data[id].logs].reverse().slice(0, 10).forEach(l => {
                    logBox.innerHTML += `<div>${l.desc} - <b>$${l.val}</b></div>`;
                });
            }
        }

        const canvas = document.getElementById('canvas-bg'), ctx = canvas.getContext('2d');
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = resize; resize();
        function anim() {
            ctx.fillStyle = "rgba(0,0,0,0.1)"; ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--primary');
            for(let i=0; i<5; i++) { ctx.fillRect(Math.random()*canvas.width, Math.random()*canvas.height, 2, 2); }
            requestAnimationFrame(anim);
        }
        anim();
    </script>
</body>
</html>




